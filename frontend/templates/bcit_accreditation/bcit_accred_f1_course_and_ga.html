{% extends 'bcit_accreditation/base.html' %}

{% block title %}Course and GA Information - BCIT Accreditation System{% endblock %}

{% block extra_css %}
{% load static %}
<link rel="stylesheet" href="{% static 'css/form1.css' %}">
{% endblock %}

{% block content %}
<div class="container">
  <div class="form-wrapper">
    <h1>Welcome to the Course Form Portal</h1>

    <h2>Course and GA info</h2>
    <p class="form-description">Please provide the following information about your course and the graduate attribute indicator that was assessed in your course.</p>

    <form id="courseGAForm">
      <input type="hidden" id="formData">
      {% csrf_token %}

      <div class="form-grid">
        <!-- Left Column -->
        <div class="form-column">
          <label for="program">Program</label>
          <select id="program" name="program" required>
            <option value="" disabled selected>Click to select</option>
            <option value="ELEX">ELEX</option>
            <option value="CIVL">CIVL</option>
            <option value="MECH">MECH</option>
            <option value="MINE">MINE</option>
          </select>

          <label for="course">Course</label>
          <input type="text" id="course" name="course" placeholder="e.g. ENGR 3800 [DNI]" required>

          <label for="academicTerm">Academic term</label>
          <input type="text" id="academicTerm" name="academicTerm" placeholder="e.g. 202510 [DNI]" required>

          <label for="programTerm">Program term</label>
          <select id="programTerm" name="programTerm" required>
            <option value="" disabled selected>Click to select</option>
            <option value="Term 1">Term 1</option>
            <option value="Term 2">Term 2</option>
            <option value="Term 3">Term 3</option>
            <option value="Term 4">Term 4</option>
          </select>

          <label for="facultyFirstName1">Faculty first name</label>
          <input type="text" id="facultyFirstName1" name="facultyFirstName1" required>

          <label for="facultyFirstName2">Faculty first name</label>
          <input type="text" id="facultyFirstName2" name="facultyFirstName2" required>

          <label for="graduateAttribute">Graduate attribute</label>
          <select id="graduateAttribute" name="graduateAttribute" required>
            <option value="" disabled selected>Click to select</option>
            <option value="Knowledge Base">Knowledge Base</option>
            <option value="Problem Analysis">Problem Analysis</option>
            <option value="Investigation">Investigation</option>
            <option value="Design">Design</option>
            <option value="Use of Tools">Use of Tools</option>
            <option value="Communication">Communication</option>
            <option value="Teamwork">Teamwork</option>
          </select>

          <label for="graduateAttributeIndicator">Graduate attribute indicator</label>
          <select id="graduateAttributeIndicator" name="graduateAttributeIndicator" required>
            <option value="" disabled selected>Click to select</option>
          </select>
        </div>

        <!-- Right Column -->
        <div class="form-column">
          <label for="instructionalLevel">Instructional level</label>
          <select id="instructionalLevel" name="instructionalLevel" required>
            <option value="" disabled selected>Click to select</option>
            <option value="Introductory">Introductory</option>
            <option value="Intermediate">Intermediate Development</option>
            <option value="Advanced">Advanced Application</option>
          </select>

          <label for="assessmentAlignment">Assessment alignment with GAI</label>
          <select id="assessmentAlignment" name="assessmentAlignment" required>
            <option value="" disabled selected>Click to select</option>
            <option value="Perfectly">Perfectly</option>
            <option value="Highly">Highly</option>
            <option value="Mostly">Mostly</option>
            <option value="Somewhat">Somewhat</option>
          </select>

          <label for="courseLearningOutcomes">Course learning outcome(s)</label>
            <select id="courseLearningOutcomes" name="courseLearningOutcomes" required>
            <option value="" disabled selected>Click to select</option>
            <option value="outcome1">Outcome 1</option>
            <option value="outcome2">Outcome 2</option>
            </select>


          <label for="assessmentType">Assessment type</label>
          <select id="assessmentType" name="assessmentType" required>
            <option value="" disabled selected>Click to select</option>
            <option value="Quiz">Quiz</option>
            <option value="Test">Test</option>
            <option value="Exam">Exam</option>
            <option value="Assignment">Assignment</option>
            <option value="Project">Project</option>
            <option value="Lab">Lab</option>
          </select>

          <label for="courseWeighting">Course % weighting</label>
          <input type="number" id="courseWeighting" name="courseWeighting" min="0" max="100" required>

          <label for="assessmentMaxScore">Assessment max score points</label>
          <input type="number" id="assessmentMaxScore" name="assessmentMaxScore" min="0" step="0.1" required>

          <label for="gaiWeight">GAI weight (%of assessment)</label>
          <input type="number" id="gaiWeight" name="gaiWeight" min="0" max="100" required>

          <label for="gaiMaxPoints">GAI max points</label>
          <input type="number" id="gaiMaxPoints" name="gaiMaxPoints" min="0" step="0.1" required>
        </div>
      </div>

      <div class="button-row">
        <button type="button" id="backButton">Back</button>
        <button type="submit" id="nextButton">Next page</button>
      </div>
    </form>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const formStorage = document.getElementById('formData');
    const form = document.getElementById('courseGAForm');

    if (sessionStorage.getItem('f1FormData')) {
      const storedData = JSON.parse(sessionStorage.getItem('f1FormData'));
      Object.keys(storedData).forEach(key => {
        const field = document.getElementById(key);
        if (field) {
          field.value = storedData[key];
        }
      });
    }

    const gaSelect = document.getElementById('graduateAttribute');
    const gaiSelect = document.getElementById('graduateAttributeIndicator');

    gaSelect.addEventListener('change', function() {
      gaiSelect.innerHTML = '<option value="" disabled selected>Click to select</option>';
      const ga = this.value;
      let indicators = [];

      switch (ga) {
        case 'Knowledge Base':
          indicators = ['KB1: Apply knowledge of mathematics', 'KB2: Apply knowledge of physics', 'KB3: Apply knowledge of engineering fundamentals'];
          break;
        case 'Problem Analysis':
          indicators = ['PA1: Identify the problem', 'PA2: Formulate the problem', 'PA3: Analyze the problem'];
          break;
        case 'Investigation':
          indicators = ['IN1: Plan investigations', 'IN2: Conduct investigations', 'IN3: Analyze data'];
          break;
        case 'Design':
          indicators = ['DE1: Define design problems', 'DE2: Generate design solutions', 'DE3: Test and refine designs'];
          break;
        case 'Use of Tools':
          indicators = ['UT1: Select appropriate tools', 'UT2: Use tools effectively', 'UT3: Create new tools when needed'];
          break;
        case 'Communication':
          indicators = ['CO1: Written communication', 'CO2: Oral communication', 'CO3: Visual communication'];
          break;
        case 'Teamwork':
          indicators = ['TW1: Operate in team roles', 'TW2: Manage team dynamics', 'TW3: Lead teams effectively'];
          break;
      }

      indicators.forEach(indicator => {
        const option = document.createElement('option');
        option.value = indicator;
        option.textContent = indicator;
        gaiSelect.appendChild(option);
      });
    });

    form.addEventListener('submit', function(event) {
      event.preventDefault();
      const formData = {};
      const formElements = form.elements;

      for (let i = 0; i < formElements.length; i++) {
        const element = formElements[i];
        if (element.name && element.name !== 'csrfmiddlewaretoken' && element.type !== 'submit' && element.type !== 'button') {
          formData[element.id] = element.value;
        }
      }

      sessionStorage.setItem('f1FormData', JSON.stringify(formData));
      window.location.href = '{% url "form_step2" %}';
    });

    document.getElementById('backButton').addEventListener('click', function() {
      sessionStorage.removeItem('f1FormData');
      window.location.href = '{% url "home" %}';
    });
  });
</script>
{% endblock %}
